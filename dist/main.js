(()=>{var t={289:(t,e,s)=>{const i=s(507);t.exports=class extends i{constructor(t){super(t),this.tiles=this.makeArrayOfTiles()}placeShips(){for(let t of Object.values(this.gameboard.ships)){let e=!1;for(;!e;){let s=this.generatePosition();this.randomRotation(t.id),e=this.gameboard.placeShip(t.id,s)}}}randomRotation(t){Math.random()<.5&&this.gameboard.ships[t].rotate()}generatePosition(){return Math.floor(100*Math.random())}setNextOutgoingAttack(){this.tiles=this.shuffleArray(this.tiles),this.nextOutgoingAttack=this.tiles.pop()}shuffleArray(t){return t.sort(((t,e)=>.5-Math.random())),t}makeArrayOfTiles(){let t=[];for(let e=0;e<100;e++)t.push(e);return t}}},998:t=>{function e(t,e){if(t.horizontal)for(let s=0;s<t.length;s++){let i=document.getElementById(`${e}-${t.position+s}`);0===s?i.classList.add("ship-left"):s===t.length-1&&i.classList.add("ship-right"),i.classList.add("tile-ship"),i.classList.add("no-drop"),i.setAttribute("data-ship-id",t.getId())}else for(let s=0;s<t.length;s++){let i=document.getElementById(`${e}-${t.position+10*s}`);0===s?i.classList.add("ship-top"):s===t.length-1&&i.classList.add("ship-bottom"),i.classList.add("tile-ship"),i.classList.add("no-drop"),i.setAttribute("data-ship-id",t.getId())}}function s(t,e){for(tileId of t.tilesShoted.water){let t=document.getElementById(`${e}-${tileId}`);t.classList.add("tile-water"),r(t)}}function i(t,e){for(tileId of t.tilesShoted.hit){let t=document.getElementById(`${e}-${tileId}`);t.classList.remove("tile-ship"),t.classList.add("tile-hit"),r(t)}}function r(t){const e=document.createElement("div");e.classList.add("shoot"),t.innerHTML="",t.appendChild(e)}function a(t,e){let s=t.sunkShips();for(shipId of s)n(t.ships[shipId],e)}function n(t,e){if(t.horizontal)for(let s=0;s<t.length;s++){let i=document.getElementById(`${e}-${t.position+s}`);0===s?i.classList.add("ship-left"):s===t.length-1&&i.classList.add("ship-right"),i.classList.remove("tile-hit"),i.classList.add("tile-sunk")}else for(let s=0;s<t.length;s++){let i=document.getElementById(`${e}-${t.position+10*s}`);0===s?i.classList.add("ship-top"):s===t.length-1&&i.classList.add("ship-bottom"),i.classList.remove("tile-hit"),i.classList.add("tile-sunk")}}t.exports={createBoard:function(t){const e=document.getElementById(t);for(let s=0;s<100;s++){let i=document.createElement("div");i.setAttribute("id",`${t}-${s}`),i.classList.add("tile"),e.appendChild(i)}},renderPlayerBoard:function(t,r){!function(t,e){document.getElementById(e).childNodes.forEach((t=>{t.classList="",t.classList.add("tile")}))}(0,r),function(t,s){for(ship of Object.values(t.ships))console.log(ship),e(ship,s)}(t,r),s(t,r),i(t,r),a(t,r)},renderEnemyBoard:function(t,e){s(t,e),i(t,e),a(t,e)}}},417:(t,e,s)=>{const i=s(390),r=s(289);t.exports=class{constructor(t,e,s,i){this.player1=this.createPlayer(t,e),this.player2=this.createPlayer(s,i),this.relatePlayers(),this.gameEnded=!1,this.winner=null}getGameEnded(){return this.gameEnded}getWinner(){return this.winner}createPlayer(t,e){if("human"===t)return new i(e);if("computer"===t)return new r(e);throw new Error('type of player not valid. Must be "human" or "computer"')}relatePlayers(){this.player1.setEnemy(this.player2),this.player2.setEnemy(this.player1)}gameTurn(){this.player1 instanceof i&&this.player2 instanceof r?(this.player1.play(),this.player2.setNextOutgoingAttack(),this.player2.play(),this.checkEndGame()):this.player1 instanceof r&&this.player2 instanceof r?(this.player1.setNextOutgoingAttack(),this.player1.play(),this.player2.setNextOutgoingAttack(),this.player2.play(),this.checkEndGame()):this.player1 instanceof i&&this.player2 instanceof i&&(this.player1.nextOutgoingAttack?this.player1.play():this.player2.nextOutgoingAttack&&(this.player2.play(),this.checkEndGame()))}checkEndGame(){(this.player1.gameboard.allShipsSank()||this.player2.gameboard.allShipsSank())&&(this.gameEnded=!0,this.setWinner())}setWinner(){this.player1.gameboard.allShipsSank()&&this.player2.gameboard.allShipsSank()?this.winner="tie":this.player1.gameboard.allShipsSank()?this.winner=this.player2:this.player2.gameboard.allShipsSank()&&(this.winner=this.player1)}}},498:(t,e,s)=>{const i=s(643);t.exports=class{constructor(){this.ships={},this.tilesWithShips={},this.tilesShoted={water:[],hit:[]}}addShip(t){let e=new i(t);return this.ships[e.getId()]=e,this.ships[e.getId()]}removeShip(t){delete this.ships[t]}placeShip(t,e){let s=this.ships[t].setPosition(e),i={};for(const e of s){if(e in this.tilesWithShips)return!1;i[e]=t}return this.tilesWithShips={...this.tilesWithShips,...i},!0}rotateShip(t){let e=this.ships[t].rotate(),s={};for(const i of e){if(!(i<99||this.tilesWithShips[i]===t)&&i in this.tilesWithShips)return console.log("false"),this.ships[t].toggleOrientation(),!1;s[i]=t}return this.cleanOldShipTiles(t),this.tilesWithShips={...this.tilesWithShips,...s},console.log(this.tilesWithShips),!0}cleanOldShipTiles(t){console.log(this.tilesWithShips);for(let e of Object.keys(this.tilesWithShips))this.tilesWithShips[e]===t&&delete this.tilesWithShips[e]}receiveAttack(t){if(this.tilesShoted.water.includes(t)||this.tilesShoted.hit.includes(t))return!1;if(t in this.tilesWithShips){const e=this.tilesWithShips[t];return this.ships[e].hit(),this.tilesShoted.hit.push(t),!0}return this.tilesShoted.water.push(t),!0}allShipsSank(){for(const t of Object.values(this.ships))if(!t.isSunk())return!1;return!0}sunkShips(){let t=[];for(const e of Object.values(this.ships))e.isSunk()&&t.push(e.id);return t}}},390:(t,e,s)=>{const i=s(507);t.exports=class extends i{constructor(t){super(t)}setNextOutgoingAttack(t){this.nextOutgoingAttack=t}}},507:(t,e,s)=>{const i=s(498);t.exports=class{constructor(t){this.name=t,this.gameboard=new i,this.nextOutgoingAttack=null,this.enemy=null}createShips(){for(let t=2;t<6;t++)for(let e=1;e<7-t;e++)this.gameboard.addShip(t)}setNextOutgoingAttack(){return null}getNextOutgoingAttack(){return this.nextOutgoingAttack}setEnemy(t){this.enemy=t}getEnemy(){return this.enemy}deleteEnemy(){this.enemy=null}play(){let t=this.getNextOutgoingAttack();this.enemy.gameboard.receiveAttack(t),this.nextOutgoingAttack=null}}},643:t=>{class e{static currentId=-1;constructor(t){if(t<=0||6<=t)throw new Error("Ship length must be between 1 and 5");this.id=this.setId(),this.length=t,this.hits=0,this.sunk=!1,this.horizontal=!0,this.position=-1}setId(){return e.currentId++,e.currentId}getId(){return this.id}hit(){return this.hits+=1,this}isSunk(){return this.hits===this.length?(this.sunk=!0,this.sunk):this.sunk}setPosition(t){if(t<0||t>99)throw new Error("position not valid");this.position=t;let e=this.setTiles();return this.position=Math.min(...e),e}setTiles(){let t=[];if(this.horizontal){const e=Math.floor(this.position/10);let s=0,i=1;for(;s<this.length;)Math.floor((this.position+s)/10)===e?t.push(this.position+s):(t.push(this.position-i),i++),s++}else{let e=0,s=1;for(;e<this.length;)this.position+10*e<100?t.push(this.position+10*e):(t.push(this.position-10*s),s++),e++}return t}rotate(){return this.horizontal=!this.horizontal,this.setTiles()}toggleOrientation(){this.horizontal=!this.horizontal}}t.exports=e}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,s),a.exports}(()=>{const t=s(417),e=s(998),i=new t("human","tony","computer","cpu2");i.player2.createShips(),i.player2.placeShips(),e.createBoard("P1Board"),e.createBoard("P1enemyBoard"),e.renderPlayerBoard(i.player1.gameboard,"P1Board");const r=document.getElementById("P1enemyBoard").childNodes;function a(t){let s=t.path[0].id.split("-")[1];i.player1.setNextOutgoingAttack(s),i.gameTurn(),e.renderPlayerBoard(i.player1.gameboard,"P1Board"),e.renderEnemyBoard(i.player2.gameboard,"P1enemyBoard"),i.getGameEnded()&&r.forEach((t=>{t.removeEventListener("click",a)})),this.removeEventListener("click",a)}let n,o;r.forEach((t=>{t.addEventListener("click",a)}));const h=document.getElementById("P1Board").childNodes;function l(t){if(t.preventDefault(),!t.target.classList.contains("no-drop")){let e=parseInt(t.target.id.split("-")[1]),s=t.dataTransfer.getData("shipLength"),r=i.player1.gameboard.addShip(s);i.player1.gameboard.placeShip(r.getId(),e)?o.parentNode.removeChild(o):i.player1.gameboard.removeShip(r.getId())}this.classList.remove("over"),t.target.classList.remove("over-tile"),e.renderPlayerBoard(i.player1.gameboard,"P1Board"),function(){let t=n.querySelectorAll(".tile-ship");console.log(t),t.forEach((t=>t.addEventListener("click",d,!1)))}()}function d(t){let s=parseInt(t.target.getAttribute("data-ship-id"));i.player1.gameboard.rotateShip(s),e.renderPlayerBoard(i.player1.gameboard,"P1Board"),console.log(i.player1.gameboard)}function p(t){o=this,this.style.opacity="0.4",t.dataTransfer.setData("shipLength",t.target.childElementCount)}function c(t){this.style.opacity="1"}function u(t){return t.preventDefault(),this.classList.add("over"),!1}function g(t){return t.preventDefault(),this.classList.remove("over"),!1}function m(t){this.classList.add("over-tile")}function f(t){this.classList.remove("over-tile")}!function(){n=document.getElementById("P1Board"),n.addEventListener("dragover",u,!1),n.addEventListener("dragleave",g,!1),n.addEventListener("drop",l,!1),h.forEach((t=>t.addEventListener("dragover",m,!1))),h.forEach((t=>t.addEventListener("dragleave",f,!1)));const t=document.getElementsByClassName("out-of-board-ship");for(let e of t)e.addEventListener("dragstart",p,!1),e.addEventListener("dragend",c,!1)}()})()})();
//# sourceMappingURL=main.js.map