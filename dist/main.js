(()=>{var e={289:(e,t,s)=>{const i=s(507);e.exports=class extends i{constructor(e){super(e),this.notAttackedTiles=this.makeArrayOfTiles()}placeShips(){for(let e of Object.values(this.gameboard.ships)){let t=!1;for(;!t;){let s=this.generatePosition();this.randomRotation(e.id),t=this.gameboard.moveShip(e.id,s)}}}randomRotation(e){Math.random()<.5&&this.gameboard.ships[e].toggleOrientation()}generatePosition(){return Math.floor(100*Math.random())}setNextOutgoingAttack(){this.notAttackedTiles=this.shuffleArray(this.notAttackedTiles),this.nextOutgoingAttack=this.notAttackedTiles.pop()}shuffleArray(e){return e.sort(((e,t)=>.5-Math.random())),e}makeArrayOfTiles(){let e=[];for(let t=0;t<100;t++)e.push(t);return e}}},153:e=>{const t=document.getElementById("player2-name"),s=document.getElementById("player1-name");e.exports={setToOnePlayer:function(e){t.style.display="none",t.required=!1,e.number=1},setToTwoPlayers:function(e){t.style.display="block",t.required=!0,e.number=2},startGame:function(e,i){1===i.number?(e.addPlayer1("human",s.value),e.addPlayer2("computer","r2-d2"),e.player1.createShips(),e.player2.createShips(),e.player2.placeShips()):2===i.number&&(e.addPlayer1("human",s.value),e.addPlayer2("human",t.value)),e.relatePlayers()}}},360:e=>{function t(e,t,s){let i=e.getTiles();if(0===i.length){const t=document.getElementById(s);let i=function(e){let t=document.createElement("div");t.classList.add("out-of-board-ship");for(let s=0;s<e;s++){let i=document.createElement("div");i.classList.add("tile"),0===s?i.classList.add("ship-left"):s===e-1&&i.classList.add("ship-right"),t.appendChild(i)}return t}(e.length);i.draggable=!0,i.setAttribute("data-ship-id",e.getId()),t.appendChild(i)}else for(let s=0;s<e.length;s++){let r=document.getElementById(`${t}-${i[s]}`);r.classList.add("tile-ship"),r.classList.add("no-drop"),r.draggable=!0,r.setAttribute("data-ship-id",e.getId()),r.setAttribute("data-ship-length",e.length),0===s?e.horizontal?r.classList.add("ship-left"):r.classList.add("ship-top"):s===e.length-1&&(e.horizontal?r.classList.add("ship-right"):r.classList.add("ship-bottom"))}}function s(e){const t=document.createElement("div");t.classList.add("shoot"),e.innerHTML="",e.appendChild(t)}e.exports={createBoard:function(e){const t=document.getElementById(e);for(let s=0;s<100;s++){let i=document.createElement("div");i.setAttribute("id",`${e}-${s}`),i.classList.add("tile"),t.appendChild(i)}},renderBoard:function(e,i,r,a){if("player"!==a&&"enemy"!==a)throw new Error("mode not valid, try with player or enemy");!function(e){document.getElementById(e).childNodes.forEach((e=>{e.classList="",e.classList.add("tile")}))}(i),"player"===a&&function(e,s,i){for(ship of Object.values(e.ships))t(ship,s,i)}(e,i,r),function(e,t){!function(e,t){for(tileId of e.shootsRecieved.water){let e=document.getElementById(`${t}-${tileId}`);e.classList.add("tile-water"),s(e)}}(e,t)}(e,i)}}},417:(e,t,s)=>{const i=s(390),r=s(289);e.exports=class{constructor(){this.player1=null,this.player2=null,this.stage="preGame",this.winner=null}addPlayer1(e,t){if("human"===e)this.player1=new i(t);else{if("computer"!==e)throw new Error('type of player not valid. Must be "human" or "computer"');this.player1=new r(t)}}addPlayer2(e,t){if("human"===e)this.player2=new i(t);else{if("computer"!==e)throw new Error('type of player not valid. Must be "human" or "computer"');this.player2=new r(t)}}relatePlayers(){this.player1.setEnemy(this.player2),this.player2.setEnemy(this.player1)}getStage(){return this.stage}setStage(e){if(!["preGame","inGame","ended"].includes(e))throw new Error("stage is not a valid game stage");this.stage=e}getWinner(){return this.winner}startGame(){if("preGame"===this.getStage()){let e=this.player1.gameboard.getShips(),t=this.player2.gameboard.getShips();return!(!this.checkAllShipsPlaced(e)||!this.checkAllShipsPlaced(t)||(this.setStage("inGame"),0))}throw new Error("Game has already been started. Try to reset to start over")}checkAllShipsPlaced(e){for(let t of Object.values(e))if(0===t.getTiles().length)return!1;return!0}gameTurn(){if("inGame"!==this.getStage())throw new Error("cannot play if the game has not started");this.player1 instanceof i&&this.player2 instanceof r?(this.player1.play(),this.player2.setNextOutgoingAttack(),this.player2.play(),this.checkEndGame()):this.player1 instanceof r&&this.player2 instanceof i?(this.player1.setNextOutgoingAttack(),this.player1.play(),this.player2.play(),this.checkEndGame()):this.player1 instanceof r&&this.player2 instanceof r?(this.player1.setNextOutgoingAttack(),this.player1.play(),this.player2.setNextOutgoingAttack(),this.player2.play(),this.checkEndGame()):this.player1 instanceof i&&this.player2 instanceof i&&(this.player1.nextOutgoingAttack?this.player1.play():this.player2.nextOutgoingAttack&&(this.player2.play(),this.checkEndGame()))}checkEndGame(){(this.player1.gameboard.allShipsSank()||this.player2.gameboard.allShipsSank())&&(this.setStage("ended"),this.setWinner())}setWinner(){this.player1.gameboard.allShipsSank()&&this.player2.gameboard.allShipsSank()?this.winner="tie":this.player1.gameboard.allShipsSank()?this.winner=this.player2:this.player2.gameboard.allShipsSank()&&(this.winner=this.player1)}}},498:(e,t,s)=>{const i=s(643);e.exports=class{constructor(){this.ships={},this.shootsRecieved={water:[],hit:[]}}addShip(e){let t=new i(e);return this.ships[t.getId()]=t,this.ships[t.getId()]}removeShip(e){delete this.ships[e]}getShips(){return this.ships}moveShip(e,t){let s=this.ships[e].getTiles();this.ships[e].setTiles(t);for(let t of Object.values(this.ships))if(t.getId()!==e&&this.shipsIntersects(t.getId(),e))return this.ships[e].setTiles(s),!1;return!0}shipsIntersects(e,t){let s=this.ships[e].getTiles(),i=this.ships[t].getTiles();for(let e of s)for(let t of i)if(e===t)return!0;return!1}rotateShip(e){if(0===this.ships[e].getTiles().length)throw new Error("Can't rotate ship outside the board");this.ships[e].toggleOrientation();let t=this.ships[e].getTiles();return this.moveShip(e,t[0])}receiveAttack(e){return!this.shootsRecieved.water.includes(e)&&!this.shootsRecieved.hit.includes(e)&&(this.shipHit(e)?this.shootsRecieved.hit.push(e):this.shootsRecieved.water.push(e),!0)}shipHit(e){let t=!1;for(let s of Object.values(this.ships))t=t||s.hit(e);return t}allShipsSank(){for(let e of Object.values(this.ships))if(!e.isSunk())return!1;return!0}}},390:(e,t,s)=>{const i=s(507);e.exports=class extends i{constructor(e){super(e)}setNextOutgoingAttack(e){this.nextOutgoingAttack=e}}},507:(e,t,s)=>{const i=s(498);e.exports=class{constructor(e){this.name=e,this.gameboard=new i,this.nextOutgoingAttack=null,this.enemy=null}createShips(){for(let e=2;e<6;e++)for(let t=1;t<7-e;t++)this.gameboard.addShip(e)}setNextOutgoingAttack(){return null}getNextOutgoingAttack(){return this.nextOutgoingAttack}setEnemy(e){this.enemy=e}getEnemy(){return this.enemy}deleteEnemy(){this.enemy=null}play(){let e=this.getNextOutgoingAttack();this.enemy.gameboard.receiveAttack(e),this.nextOutgoingAttack=null}}},643:e=>{class t{static currentId=-1;constructor(e){if(e<=0||6<=e)throw new Error("Ship length must be between 1 and 5");this.id=this.setId(),this.length=e,this.horizontal=!0,this.tiles=[],this.hits={}}setId(){return t.currentId++,t.currentId}getId(){return this.id}getTiles(){return this.tiles}setTiles(e){if(Number.isInteger(e)){if(e<0||e>99)throw new Error("position not valid");this.tiles=this.chooseTiles(e),this.generateHitsObject(this.tiles)}else if(Array.isArray(e)){if(0!==e.length&&this.length!==e.length)throw new Error("The number of tiles you're trying to assign does not match with the ship length");this.tiles=e}}chooseTiles(e){let t=[];if(this.horizontal){const s=Math.floor(e/10);let i=0,r=1;for(;i<this.length;)Math.floor((e+i)/10)===s?t.push(e+i):(t.push(e-r),r++),i++}else{let s=0,i=1;for(;s<this.length;)e+10*s<100?t.push(e+10*s):(t.push(e-10*i),i++),s++}return t.sort(((e,t)=>e-t)),t}generateHitsObject(e){this.hits={},e.forEach((e=>this.hits[e]=!1))}isHorizontal(){return this.horizontal}toggleOrientation(){this.horizontal=!this.horizontal}hit(e){return e in this.hits&&(this.hits[e]=!0,!0)}getHits(){return this.hits}isSunk(){for(let e of Object.values(this.hits))if(!e)return!1;return!0}}e.exports=t}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,s),a.exports}(()=>{const e=s(417),t=s(360),i=s(153);let r={number:1},a=new e;const n=document.getElementById("1player"),l=document.getElementById("2players"),o=document.getElementById("player-names"),h=document.getElementById("pre-game-settings");n.addEventListener("click",(e=>{e.preventDefault(),i.setToOnePlayer(r)})),l.addEventListener("click",(e=>{e.preventDefault(),i.setToTwoPlayers(r)})),o.addEventListener("submit",(e=>{e.preventDefault(),i.startGame(a,r),t.createBoard("P1Board"),t.createBoard("P1enemyBoard");for(let e=0;e<10;e++)a.player1.gameboard.moveShip(e,10*e);t.renderBoard(a.player1.gameboard,"P1Board","ship-container","player"),t.renderBoard(a.player2.gameboard,"P1enemyBoard","ship-container2","player"),h.style.display="none"})),document.getElementById("placing-finished").addEventListener("click",(()=>{console.log(a),a.startGame(),console.log(a),a.player1.setNextOutgoingAttack(12),a.gameTurn(),a.player1.setNextOutgoingAttack(15),a.gameTurn(),a.player1.setNextOutgoingAttack(17),a.gameTurn(),t.renderBoard(a.player1.gameboard,"P1Board","ship-container","player"),t.renderBoard(a.player2.gameboard,"P1enemyBoard","ship-container2","player"),console.log(a)}))})()})();
//# sourceMappingURL=main.js.map