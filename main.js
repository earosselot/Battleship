(()=>{var e={289:(e,t,s)=>{const i=s(507);e.exports=class extends i{constructor(e){super(e),this.notAttackedTiles=this.makeArrayOfTiles()}placeShips(){for(let e of Object.values(this.gameboard.ships)){let t=!1;for(;!t;){let s=this.generatePosition();this.randomRotation(e.id),t=this.gameboard.moveShip(e.id,s)}}}randomRotation(e){Math.random()<.5&&this.gameboard.ships[e].toggleOrientation()}generatePosition(){return Math.floor(100*Math.random())}setNextOutgoingAttack(){this.notAttackedTiles=this.shuffleArray(this.notAttackedTiles),this.nextOutgoingAttack=this.notAttackedTiles.pop()}shuffleArray(e){return e.sort(((e,t)=>.5-Math.random())),e}makeArrayOfTiles(){let e=[];for(let t=0;t<100;t++)e.push(t);return e}}},153:e=>{const t=document.getElementById("player2-name"),s=document.getElementById("player1-name");e.exports={setToOnePlayer:function(e){t.style.display="none",t.required=!1,e.number=1},setToTwoPlayers:function(e){t.style.display="block",t.required=!0,e.number=2},startGame:function(e,i){1===i.number?(e.addPlayer1("human",s.value),e.addPlayer2("computer","r2-d2"),e.player1.createShips(),e.player2.createShips(),e.player2.placeShips()):2===i.number&&(e.addPlayer1("human",s.value),e.addPlayer2("human",t.value)),e.relatePlayers()}}},360:e=>{function t(e,t,s){let i=e.getTiles();if(0===i.length){let t=document.getElementById(s),i=function(e){let t=document.createElement("div");t.classList.add("out-of-board-ship");for(let s=0;s<e;s++){let i=document.createElement("div");i.classList.add("tile"),0===s?i.classList.add("ship-left"):s===e-1&&i.classList.add("ship-right"),t.appendChild(i)}return t}(e.length);i.setAttribute("data-shipId",e.getId()),t.appendChild(i)}else for(let s=0;s<e.length;s++){let a=document.getElementById(`${t}-${i[s]}`);a.classList.add("tile-ship"),a.setAttribute("data-shipId",e.getId()),a.setAttribute("data-ship-length",e.length),0===s?e.horizontal?a.classList.add("ship-left"):a.classList.add("ship-top"):s===e.length-1&&(e.horizontal?a.classList.add("ship-right"):a.classList.add("ship-bottom"))}}function s(e){const t=document.createElement("div");t.classList.add("shoot"),e.innerHTML="",e.appendChild(t)}e.exports={createBoard:function(e){const t=document.getElementById(e);t.innerHTML="";for(let s=0;s<100;s++){let i=document.createElement("div");i.setAttribute("id",`${e}-${s}`),i.classList.add("tile"),t.appendChild(i)}},renderBoard:function(e,i,a,r){if("player"!==r&&"enemy"!==r)throw new Error("mode not valid, try with player or enemy");!function(e){document.getElementById(e).childNodes.forEach((e=>{e.classList="",e.classList.add("tile")}))}(i),function(e){document.getElementById(e).innerHTML=""}(a),"player"===r&&function(e,s,i){for(ship of Object.values(e.getShips()))t(ship,s,i)}(e,i,a),function(e,i){(function(e,t){for(tileId of e.shootsRecieved.water){let e=document.getElementById(`${t}-${tileId}`);e.classList.add("tile-water"),s(e)}})(e,i),function(e,t){for(tileId of e.shootsRecieved.hit){let e=document.getElementById(`${t}-${tileId}`);e.classList.remove("tile-ship"),e.classList.add("tile-hit"),s(e)}}(e,i),function(e,s){Object.values(e.getShips()).forEach((e=>{e.isSunk()&&(t(e,s,null),e.getTiles().forEach((e=>{let t=document.getElementById(`${s}-${e}`);t.classList.remove("tile-hit"),t.classList.remove("tile-ship"),t.classList.add("tile-sunk")})))}))}(e,i)}(e,i)}}},417:(e,t,s)=>{const i=s(390),a=s(289);e.exports=class{constructor(){this.player1=null,this.player2=null,this.stage="preGame",this.winner=null}addPlayer1(e,t){if("human"===e)this.player1=new i(t);else{if("computer"!==e)throw new Error('type of player not valid. Must be "human" or "computer"');this.player1=new a(t)}}addPlayer2(e,t){if("human"===e)this.player2=new i(t);else{if("computer"!==e)throw new Error('type of player not valid. Must be "human" or "computer"');this.player2=new a(t)}}relatePlayers(){this.player1.setEnemy(this.player2),this.player2.setEnemy(this.player1)}getStage(){return this.stage}setStage(e){if(!["preGame","inGame","ended"].includes(e))throw new Error("stage is not a valid game stage");this.stage=e}getWinner(){return this.winner}startGame(){if("preGame"===this.getStage()){let e=this.player1.gameboard.getShips(),t=this.player2.gameboard.getShips();return!(!this.checkAllShipsPlaced(e)||!this.checkAllShipsPlaced(t)||(this.setStage("inGame"),0))}throw new Error("Game has already been started. Try to reset to start over")}checkAllShipsPlaced(e){for(let t of Object.values(e))if(0===t.getTiles().length)return!1;return!0}gameTurn(){if("inGame"!==this.getStage())throw new Error("can not play if the game has not started");this.player1 instanceof i&&this.player2 instanceof a?(this.player1.attack(),this.player2.setNextOutgoingAttack(),this.player2.attack(),this.checkEndGame()):this.player1 instanceof a&&this.player2 instanceof i?(this.player1.setNextOutgoingAttack(),this.player1.attack(),this.player2.attack(),this.checkEndGame()):this.player1 instanceof a&&this.player2 instanceof a?(this.player1.setNextOutgoingAttack(),this.player1.attack(),this.player2.setNextOutgoingAttack(),this.player2.attack(),this.checkEndGame()):this.player1 instanceof i&&this.player2 instanceof i&&(this.player1.nextOutgoingAttack?this.player1.attack():this.player2.nextOutgoingAttack&&(this.player2.attack(),this.checkEndGame()))}checkEndGame(){(this.player1.gameboard.allShipsSank()||this.player2.gameboard.allShipsSank())&&(this.setStage("ended"),this.setWinner())}setWinner(){this.player1.gameboard.allShipsSank()&&this.player2.gameboard.allShipsSank()?this.winner="tie":this.player1.gameboard.allShipsSank()?this.winner=this.player2:this.player2.gameboard.allShipsSank()&&(this.winner=this.player1)}}},498:(e,t,s)=>{const i=s(643);e.exports=class{constructor(){this.ships={},this.shootsRecieved={water:[],hit:[]}}addShip(e){let t=new i(e);return this.ships[t.getId()]=t,this.ships[t.getId()]}removeShip(e){delete this.ships[e]}getShips(){return this.ships}moveShip(e,t){let s=this.ships[e].getTiles();this.ships[e].setTiles(t);for(let t of Object.values(this.ships))if(t.getId()!==e&&this.shipsIntersects(t.getId(),e))return this.ships[e].setTiles(s),!1;return!0}shipsIntersects(e,t){let s=this.ships[e].getTiles(),i=this.ships[t].getTiles();if(s.length>0&&i.length>0)for(let e of s)for(let t of i)if(e===t)return!0;return!1}rotateShip(e){if(0===this.ships[e].getTiles().length)throw new Error("Can't rotate ship outside the board");this.ships[e].toggleOrientation();let t=this.ships[e].getTiles(),s=this.moveShip(e,t[0]);return s||(this.ships[e].toggleOrientation(),s)}receiveAttack(e){return Number.isInteger(e)?!this.shootsRecieved.water.includes(e)&&!this.shootsRecieved.hit.includes(e)&&(this.shipHit(e)?this.shootsRecieved.hit.push(e):this.shootsRecieved.water.push(e),!0):null}shipHit(e){let t=!1;for(let s of Object.values(this.ships))t=t||s.hit(e);return t}allShipsSank(){for(let e of Object.values(this.ships))if(!e.isSunk())return!1;return!0}}},390:(e,t,s)=>{const i=s(507);e.exports=class extends i{constructor(e){super(e)}setNextOutgoingAttack(e){this.nextOutgoingAttack=e}}},507:(e,t,s)=>{const i=s(498);e.exports=class{constructor(e){this.name=e,this.gameboard=new i,this.nextOutgoingAttack=null,this.enemy=null}createShips(){for(let e=2;e<6;e++)for(let t=1;t<7-e;t++)this.gameboard.addShip(e)}setNextOutgoingAttack(){return null}getNextOutgoingAttack(){return this.nextOutgoingAttack}setEnemy(e){this.enemy=e}getEnemy(){return this.enemy}deleteEnemy(){this.enemy=null}attack(){let e=this.getNextOutgoingAttack();this.enemy.gameboard.receiveAttack(e),this.nextOutgoingAttack=null}}},643:e=>{class t{static currentId=-1;constructor(e){if(e<=0||6<=e)throw new Error("Ship length must be between 1 and 5");this.id=this.setId(),this.length=e,this.horizontal=!0,this.tiles=[],this.hits={}}setId(){return t.currentId++,t.currentId}getId(){return this.id}getTiles(){return this.tiles}setTiles(e){if(Number.isInteger(e)){if(e<0||e>99)throw new Error("position not valid");this.tiles=this.chooseTiles(e),this.generateHitsObject(this.tiles)}else if(Array.isArray(e)){if(0!==e.length&&this.length!==e.length)throw new Error("The number of tiles you're trying to assign does not match with the ship length");this.tiles=e}}chooseTiles(e){let t=[];if(this.horizontal){const s=Math.floor(e/10);let i=0,a=1;for(;i<this.length;)Math.floor((e+i)/10)===s?t.push(e+i):(t.push(e-a),a++),i++}else{let s=0,i=1;for(;s<this.length;)e+10*s<100?t.push(e+10*s):(t.push(e-10*i),i++),s++}return t.sort(((e,t)=>e-t)),t}generateHitsObject(e){this.hits={},e.forEach((e=>this.hits[e]=!1))}isHorizontal(){return this.horizontal}toggleOrientation(){this.horizontal=!this.horizontal}hit(e){return e in this.hits&&(this.hits[e]=!0,!0)}getHits(){return this.hits}isSunk(){if(this.getTiles().length>0){for(let e of Object.values(this.hits))if(!e)return!1;return!0}return!1}}e.exports=t}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}(()=>{const e=s(417),t=s(390),i=s(289),a=s(360),r=s(153);let n={number:1},l=new e;const o=document.getElementById("1player"),d=document.getElementById("2players"),h=document.getElementById("player-names-form"),c=document.getElementById("pre-game-settings"),p=document.getElementById("game-container"),g=document.getElementById("placing-finished"),m=document.getElementById("play-again"),u=document.getElementById("help-text"),y=document.getElementById("P1enemyBoard"),f=document.getElementById("ship-container"),v=document.getElementById("board-container");function E(){r.startGame(l,n),a.createBoard("P1Board"),a.createBoard("P1enemyBoard"),a.renderBoard(l.player1.gameboard,"P1Board","ship-container","player"),y.style.display="none",f.style.display="flex",c.style.display="none",p.style.display="block",g.style.display="block",g.classList.add("disabled"),m.style.display="none",v.style.flexDirection="column",k(),document.getElementById("stage-3").classList.remove("active-stage"),u.classList.remove("result"),document.getElementById("stage-1").classList.add("active-stage"),u.innerHTML="<p>Drag and drop the ships into the board. Click on ships to rotate</p>"}function L(s){let r=s.path||s.composedPath&&s.composedPath(),n=parseInt(r[0].id.split("-")[1]);l.player1.setNextOutgoingAttack(n),l.gameTurn(),a.renderBoard(l.player1.gameboard,"P1Board","ship-container","player"),a.renderBoard(l.player2.gameboard,"P1enemyBoard","ship-container2","enemy"),"ended"===l.getStage()&&(document.getElementById("P1enemyBoard").childNodes.forEach((e=>{e.removeEventListener("click",L)})),m.classList.remove("disabled"),m.addEventListener("click",(()=>{l=new e,E()})),document.getElementById("stage-2").classList.remove("active-stage"),document.getElementById("stage-3").classList.add("active-stage"),l.getWinner()instanceof t||l.getWinner()instanceof i?u.innerHTML=`<p>${l.getWinner().name} has sunk all enemy ships and won the war!</p>`:u.innerHTML="<p>Amazing! all the ships have been sunk at the same time!!</p><p>The game is tie!</p>",u.classList.add("result")),this.removeEventListener("click",L)}function k(){let e=document.getElementById("P1Board");e.addEventListener("dragover",T,!1),e.addEventListener("dragleave",A,!1),e.addEventListener("drop",b,!1);const t=document.getElementById("P1Board").childNodes;t.forEach((e=>e.addEventListener("dragover",x,!1))),t.forEach((e=>e.addEventListener("dragleave",O,!1)));const s=document.getElementsByClassName("out-of-board-ship");for(let e of s)e.addEventListener("dragstart",S,!1),e.addEventListener("dragend",w,!1),e.draggable=!0;const i=document.getElementsByClassName("tile-ship");for(let e of i)e.addEventListener("dragstart",S,!1),e.addEventListener("dragend",w,!1),e.classList.add("drag-on"),i.draggable=!0}function b(e){e.preventDefault();let t=parseInt(e.target.id.split("-")[1]),s=parseInt(e.dataTransfer.getData("shipId"));l.player1.gameboard.moveShip(s,t),this.classList.remove("over"),e.target.classList.remove("over-tile"),a.renderBoard(l.player1.gameboard,"P1Board","ship-container","player"),0===f.childNodes.length&&(f.style.display="none",g.classList.remove("disabled")),k(),B()}function B(){document.getElementById("P1Board").querySelectorAll(".tile-ship").forEach((e=>e.addEventListener("click",I,!1)))}function I(e){let t=parseInt(e.target.getAttribute("data-shipid"));l.player1.gameboard.rotateShip(t),a.renderBoard(l.player1.gameboard,"P1Board","ship-container","player"),k(),B()}function S(e){this.style.opacity="0.4",e.dataTransfer.setData("shipId",e.target.dataset.shipid)}function w(e){this.style.opacity="1"}function T(e){return e.preventDefault(),this.classList.add("over"),!1}function A(e){return e.preventDefault(),this.classList.remove("over"),!1}function x(e){this.classList.add("over-tile")}function O(e){this.classList.remove("over-tile")}o.addEventListener("click",(e=>{e.preventDefault(),r.setToOnePlayer(n)})),d.addEventListener("click",(e=>{e.preventDefault(),r.setToTwoPlayers(n)})),h.addEventListener("submit",(e=>{e.preventDefault(),E()})),g.addEventListener("click",(()=>{l.startGame()&&(g.style.display="none",m.style.display="block",m.classList.add("disabled"),y.style.display="grid",f.style.display="none",document.getElementById("P1enemyBoard").childNodes.forEach((e=>e.addEventListener("click",L))),document.getElementById("stage-1").classList.remove("active-stage"),document.getElementById("stage-2").classList.add("active-stage"),v.style.flexDirection="row",u.innerHTML="<p>Click on the enemy board to attack tiles.</p>",function(){let e=document.getElementById("P1Board");e.removeEventListener("dragover",T),e.removeEventListener("dragleave",A),e.removeEventListener("drop",b);const t=document.getElementById("P1Board").childNodes;t.forEach((e=>e.removeEventListener("dragover",x))),t.forEach((e=>e.removeEventListener("dragleave",O)));const s=document.getElementsByClassName("tile-ship");for(let e of s)e.removeEventListener("dragstart",S),e.removeEventListener("dragend",w),e.classList.remove("drag-on"),e.draggable=!1}(),document.getElementById("P1Board").querySelectorAll(".tile-ship").forEach((e=>e.removeEventListener("click",I))))}))})()})();
//# sourceMappingURL=main.js.map